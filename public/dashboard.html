<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard de Visitas</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      margin: 0;
      padding: 1rem;
    }
    h1 {
      text-align: center;
    }
    .visita {
      background: white;
      border-radius: 8px;
      box-shadow: 0 0 6px rgba(0,0,0,0.1);
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .visita pre {
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .detalles {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
    }
    .campo {
      margin-bottom: 0.25rem;
    }
    .campo strong {
      display: inline-block;
      width: 160px;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <h1>Dashboard de Visitas</h1>
  <div id="contenedor"></div>

  <script>
    async function cargarVisitas() {
      const res = await fetch('/api/visitas');
      const visitas = await res.json();
      const contenedor = document.getElementById('contenedor');
      contenedor.innerHTML = '';

      visitas.forEach(v => {
        const div = document.createElement('div');
        div.className = 'visita';

        const geo = v.geoip ? `${v.geoip.city || 'Ciudad desconocida'}, ${v.geoip.country || 'País desconocido'}` : 'Sin geolocalización';
        const coords = v.coords ? `Lat: ${v.coords.latitude}, Lon: ${v.coords.longitude}` : 'No disponibles';

        div.innerHTML = `
          <div class="detalles">
            <div class="campo"><strong>Fecha:</strong> ${new Date(v.hora).toLocaleString()}</div>
            <div class="campo"><strong>IP:</strong> ${v.ip}</div>
            <div class="campo"><strong>GeoIP:</strong> ${geo}</div>
            <div class="campo"><strong>Coordenadas:</strong> ${coords}</div>
            <div class="campo"><strong>Navegador:</strong> ${v.navegador || v.navegadorDetectado}</div>
            <div class="campo"><strong>SO:</strong> ${v.sistemaOperativo || v.sistemaOperativoDetectado}</div>
            <div class="campo"><strong>Tipo de Dispositivo:</strong> ${v.dispositivoTipo || v.dispositivoDetectado?.tipo}</div>
            <div class="campo"><strong>Marca:</strong> ${v.dispositivoMarca || v.dispositivoDetectado?.marca}</div>
            <div class="campo"><strong>Modelo:</strong> ${v.dispositivoModelo || v.dispositivoDetectado?.modelo}</div>
            <div class="campo"><strong>Resolución:</strong> ${v.resolucion}</div>
            <div class="campo"><strong>Idioma:</strong> ${v.idioma}</div>
            <div class="campo"><strong>Zona horaria:</strong> ${v.zonaHoraria}</div>
            <div class="campo"><strong>Referrer:</strong> ${v.referrer || 'Directo'}</div>
            <div class="campo"><strong>Duración (s):</strong> ${v.duracion}</div>
            <div class="campo"><strong>Red:</strong> ${v.tipoRed || 'No detectada'}</div>
            <div class="campo"><strong>Batería:</strong> ${v.bateria ? `${(v.bateria.nivel * 100).toFixed(0)}% (${v.bateria.cargando ? 'Cargando' : 'No cargando'})` : 'No disponible'}</div>
            <div class="campo"><strong>Cookies habilitadas:</strong> ${v.cookiesHabilitadas ? 'Sí' : 'No'}</div>
            <div class="campo"><strong>LocalStorage:</strong> ${v.soportaLocal ? 'Sí' : 'No'}</div>
            <div class="campo"><strong>SessionStorage:</strong> ${v.soportaSession ? 'Sí' : 'No'}</div>
            <div class="campo"><strong>Pestaña activa:</strong> ${v.pestañaActiva ? 'Sí' : 'No'}</div>
            <div class="campo"><strong>¿Es bot?:</strong> ${v.esBot ? 'Sí' : 'No'}</div>
            <div class="campo"><strong>User-Agent:</strong> ${v.userAgent}</div>
          </div>
        `;

        contenedor.appendChild(div);
      });
    }

    cargarVisitas();
  </script>
</body>
</html>

